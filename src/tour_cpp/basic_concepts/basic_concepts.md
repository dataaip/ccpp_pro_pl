### C++ 基本概念详解

#### 1. **C++ 程序结构**
   - **定义**：C++ 程序由头文件（`.hpp`/`.h`）和源文件（`.cpp`）组成，经编译、链接生成可执行文件。程序从 `main` 函数启动。
   - **示例**：
     ```cpp
     // main.cpp
     #include <iostream>  // 标准头文件

     int main() {         // 程序入口
         std::cout << "Hello, C++!\n";
         return 0;
     }
     ```
   - **编译过程**：`g++ main.cpp -o program` → 生成可执行文件 `program`。

#### 2. **关键字与标识符**
   - **关键字**：C++ 保留的特殊单词（如 `class`, `virtual`, `noexcept`）。C++20 有约 90 个关键字。
     ```cpp
     int class = 5; // 错误：class 是关键字
     ```
   - **标识符规则**：
     - 字母/数字/下划线组成，首字符不能是数字
     - 区分大小写（`value` ≠ `Value`）
   - **特殊标识符**：`override`（C++11 起为关键字，但可作标识符兼容旧代码）

#### 3. **注释与字符处理**
   - **注释**：被编译器忽略
     - `//` 单行注释
     - `/* */` 多行注释
   - **字符与转义序列**：
     ```cpp
     std::cout << "Line1\nLine2\t"; // \n=换行, \t=制表符
     std::string path = "C:\\Docs\\"; // \\ 表示反斜杠
     ```

#### 4. **C++ 实体（Entities）**
   | 实体类型          | 说明                          | 示例                     |
   |-------------------|-------------------------------|--------------------------|
   | 值                | 如 `42`, `3.14`               | `int x = 42;`            |
   | 对象              | 内存区域                      | `int arr[10];`           |
   | 引用              | 对象的别名                    | `int& ref = x;`          |
   | 结构化绑定 (C++17)| 分解对象成员                  | `auto [id, name] = person;` |
   | 函数              | 可执行单元                    | `void print() { ... }`   |
   | 类型              | 定义对象行为                  | `using Vector = std::vector<int>;` |
   | 模板              | 泛型编程结构                  | `template<typename T> class Box;` |
   | **非实体**        | 预处理器宏                    | `#define PI 3.14`        |

#### 5. **声明与定义**
   - **声明**：引入名称（不分配存储）
     ```cpp
     extern int global_var; // 声明
     class MyClass;         // 前向声明
     ```
   - **定义**：完整描述实体（分配存储）
     ```cpp
     int global_var = 10;              // 变量定义
     class MyClass { int data; };      // 类定义
     void func() { /* 函数体 */ }      // 函数定义
     ```
   - **ODR 规则（One Definition Rule）**：
     - 非内联函数/变量在程序中只能有一个定义
     - 违反示例（导致链接错误）：
       ```cpp
       // file1.cpp
       int shared = 5;
       
       // file2.cpp
       int shared = 10; // 错误：重复定义
       ```

#### 6. **名称查找与作用域**
   - **名称查找**：关联名称到声明
     ```cpp
     namespace NS {
         void func();
     }
     NS::func(); // 限定查找
     ```
   - **作用域类型**：
     ```cpp
     int global; // 文件作用域
     
     void foo() {
         int local; // 块作用域
         static int persistent; // 函数作用域
     }
     
     class Widget {
         int member; // 类作用域
     };
     ```

#### 7. **链接（Linkage）**
   | 链接类型     | 关键字          | 作用范围         | 示例                     |
   |-------------|----------------|------------------|--------------------------|
   | 外部链接     | `extern`（默认）| 跨翻译单元       | `int shared;`（全局变量） |
   | 内部链接     | `static`       | 当前翻译单元     | `static int file_local;` |
   | 无链接       | 无             | 当前作用域       | 局部变量、函数参数       |
   ```cpp
   // 匿名命名空间（C++替代static的方案）
   namespace {
       int hidden_var; // 内部链接
   }
   ```

#### 8. **类型系统**
   - **类型分类**：
     ```cpp
     // 基础类型
     int, double, char, bool
     
     // 复合类型
     int* ptr;         // 指针
     int& ref = x;     // 引用
     int arr[5];       // 数组
     
     // 用户定义类型
     class Student { /*...*/ };
     enum Color { RED, GREEN };
     
     // 不完整类型（前置声明）
     class Incomplete; // 不能实例化
     ```
   - **类型特性示例**：
     ```cpp
     std::cout << sizeof(int);    // 4 (通常)
     std::cout << typeid(x).name(); // 类型名称
     ```

#### 9. **变量（Variables）**
   - **定义**：非静态数据成员的**对象**或**引用**
     ```cpp
     int global_var;          // 变量（对象）
     int& ref = global_var;   // 变量（引用）
     
     class MyClass {
         static int s_var;    // 静态成员变量（是变量）
         int member;          // 非静态成员（不是变量！）
     };
     ```
   - **特殊变量类型**：
     ```cpp
     constexpr int MAX = 100; // 编译期常量
     thread_local int tls;    // 线程局部存储
     ```

---

### **C++ vs C 核心差异总结**
| **概念**         | **C**                                | **C++**                              | **关键增强**                     |
|------------------|--------------------------------------|--------------------------------------|----------------------------------|
| 程序入口         | `main` 函数                          | `main` 函数                          | 支持全局对象构造函数在main前执行 |
| 实体类型         | 基础对象/函数                        | 扩展至引用/模板/命名空间等           | 新增结构化绑定、lambda表达式     |
| 作用域管理       | 文件/块作用域                        | 新增类作用域、命名空间作用域         | 更精细的访问控制                |
| 链接控制         | `static`/`extern`                    | 新增匿名命名空间                     | 更好的封装性                    |
| 类型系统         | 基础类型+结构体/联合                 | 类、模板、RTTI、类型别名             | 面向对象与泛型编程              |
| ODR规则          | 简单重复定义检查                     | 明确区分声明/定义，支持内联放宽      | 支持模板特化、类内定义          |
| 变量定义         | 所有声明对象均为变量                 | 排除非静态数据成员                   | 更精确的语义划分                |

### **核心概念总结**
1. **程序构建**：头文件声明 + 源文件定义 → 编译链接 → 可执行文件
2. **实体管理**：通过声明引入实体，ODR 确保定义唯一性
3. **名称解析**：作用域限定可见性，链接控制跨文件访问
4. **类型安全**：静态类型系统贯穿所有操作
5. **变量本质**：存储对象或引用，排除类非静态成员

> C++ 通过丰富的实体类型（如引用、模板）和精细的作用域控制（命名空间、类作用域），在兼容 C 的同时支持面向对象与泛型编程。严格的 ODR 规则和类型系统是构建大型程序的基础，而变量定义的精确化反映了其对抽象机制的强化。